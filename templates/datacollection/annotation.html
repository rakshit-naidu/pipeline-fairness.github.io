<!DOCTYPE html>
<html>
<head>
    <title>DATA COLLECTION : ANNOTATION</title>
    <style>
        /* Add custom styles for the table if needed */
        .post-container {
            margin: 20px 20px 0 0;
            border: 5px solid #333;
            overflow: auto
        }

        .post-thumb {
            float: left
        }

        .post-thumb img {
            display: block;
            width: 200px;
            height: auto;
        }

        .post-content {
            margin-left: 210px
        }

        .post-title {
            font-weight: bold;
            font-size: 200%;
            padding: 9px;
            background: #ccc
        }

        .tabs {
            margin-top: 20px;
        }

        .tabs ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: space-between;
        }

        .tabs li {
            flex: 1;
            text-align: center;
        }

        .tabs li a {
            display: block;
            padding: 10px;
            background-color: #f2f2f2;
            color: #333;
            text-decoration: none;
            border: 1px solid #ccc;
            border-bottom: none;
        }

        .tabs li.active a {
            background-color: #fff;
            border-color: #ccc;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .tab-content table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1px;
        }

        .tab-content table th,
        .tab-content table td {
            padding: 5px;
            text-align: center;
            border: 1px solid #ccc;
        }

        .tab-content table td input {
            width: 100%;
            box-sizing: border-box;
        }

        .tab-content table td button {
            width: 100%;
        }
    </style>
</head>
<body>
<div class="post-container">
    <h3 class="post-title">DATA COLLECTION : ANNOTATION</h3>
    <div class="post-thumb"><img src="/static/data_collection.png" alt="DATA COLLECTION"/></div>
    <div class="post-content">
        <p>Data collection involves collecting or compiling data to train the model. This involves making choices—or
            implicitly accepting previously made choices—about how to sample, label, link, and omit data. Some questions
            include—What population will we sample to build our model? How will we collect this data? What measurement
            device will be used?</p>
    </div>
</div>
<div class="tabs">
    <ul>
        <!-- <li><a href="#casestudy">Case Study</a></li> -->
        <li class="active"><a href="#problemidentification">Problem Identification</a></li>
        <li><a href="#measurement">Measurement</a></li>
        <li><a href="#mitigation">Mitigation</a></li>
    </ul>
    <div class="tab-content active" id="problemidentification">
        <table id="sub-table1">
            <thead>
            <tr>
                <th>Paper Title</th>
                <th>Authors</th>
                <th>Description</th>
                <th>Tags/Comments</th>
                <th>Conference Venue</th>
                <th>Year</th>
                <th>Paper link</th>
                <th>Additional resources</th>
                <th>Action</th>
            </tr>
            </thead>
            <tbody>
            <!-- Table rows will be dynamically generated by JavaScript -->
            {% for row in sub_table1 %}
            <tr>
                {% for cell in row %}
                {% if cell == "Paper link" %}
                {% if row[cell] == "N/A"%}
                <td></td>
                {% else %}
                <td><a href="{{ row[cell] }}">Link</a></td>
                {% endif %}
                {% else %}
                <td>{{ row[cell] }}</td>
                {% endif %}
                {% endfor %}
                <td><button onclick="editRow(this)">Edit</button></td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
        <button onclick="addRow('sub-table1')">Add Row</button>
        <button onclick="saveTable('sub-table1')">Save Table</button>
    </div>
    <div class="tab-content" id="measurement">
        <table id="sub-table2">
            <thead>
            <tr>
                <th>Paper Title</th>
                <th>Authors</th>
                <th>Description</th>
                <th>Tags/Comments</th>
                <th>Conference Venue</th>
                <th>Year</th>
                <th>Paper link</th>
                <th>Additional resources</th>
                <th>Action</th>
            </tr>
            </thead>
            <tbody>
            <!-- Table rows will be dynamically generated by JavaScript -->
            {% for row in sub_table2 %}
            <tr>
                {% for cell in row %}
                {% if cell == "Paper link" %}
                {% if row[cell] == "N/A"%}
                <td></td>
                {% else %}
                <td><a href="{{ row[cell] }}">Link</a></td>
                {% endif %}
                {% else %}
                <td>{{ row[cell] }}</td>
                {% endif %}
                {% endfor %}
                <td><button onclick="editRow(this)">Edit</button></td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
        <button onclick="addRow('sub-table2')">Add Row</button>
        <button onclick="saveTable('sub-table2')">Save Table</button>
    </div>
    <div class="tab-content" id="mitigation">
        <table id="sub-table3">
            <thead>
            <tr>
                <th>Paper Title</th>
                <th>Authors</th>
                <th>Description</th>
                <th>Tags/Comments</th>
                <th>Conference Venue</th>
                <th>Year</th>
                <th>Paper link</th>
                <th>Additional resources</th>
                <th>Action</th>
            </tr>
            </thead>
            <tbody>
            <!-- Table rows will be dynamically generated by JavaScript -->
            {% for row in sub_table3 %}
            <tr>
                {% for cell in row %}
                {% if cell == "Paper link" %}
                {% if row[cell] == "N/A"%}
                <td></td>
                {% else %}
                <td><a href="{{ row[cell] }}">Link</a></td>
                {% endif %}
                {% else %}
                <td>{{ row[cell] }}</td>
                {% endif %}
                {% endfor %}
                <td><button onclick="editRow(this)">Edit</button></td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
        <button onclick="addRow('sub-table3')">Add Row</button>
        <button onclick="saveTable('sub-table3')">Save Table</button>
    </div>
</div>
<script>
    const tabLinks = document.querySelectorAll('.tabs li a');
    const tabContents = document.querySelectorAll('.tab-content');

    tabLinks.forEach((link) => {
        link.addEventListener('click', (e) => {
            e.preventDefault();

            const targetId = e.target.getAttribute('href').substr(1);
            console.log(targetId)

            tabLinks.forEach((link) => {
                link.parentNode.classList.remove('active');
            });

            tabContents.forEach((content) => {
                content.classList.remove('active');
            });

            e.target.parentNode.classList.add('active');
            document.getElementById(targetId).classList.add('active');
        });
    });

    // Function to add a new row
    function addRow(tableId) {
        const table = document.getElementById(tableId);
        const row = table.insertRow(-1);
        const cellCount = table.rows[0].cells.length;

        for (let i = 0; i < cellCount; i++) {
            const cell = row.insertCell(i);
            const input = document.createElement('input');
            cell.appendChild(input);
        }

        const actionCell = row.insertCell(cellCount);
        const saveButton = document.createElement('button');
        saveButton.textContent = 'Save';
        saveButton.onclick = function () {
            saveRow(this);
        };
        actionCell.appendChild(saveButton);

        const cancelButton = document.createElement('button');
        cancelButton.textContent = 'Cancel';
        cancelButton.onclick = function () {
            cancelEditRow(this);
        };
        actionCell.appendChild(cancelButton);
    }

    // Function to edit a row
    function editRow(button) {
        const row = button.parentNode.parentNode;
        const cells = row.cells;
        const cellCount = cells.length - 1; // Exclude action cell

        for (let i = 0; i < cellCount; i++) {
            const cell = cells[i];
            const value = cell.textContent.trim();

            cell.innerHTML = '';
            const input = document.createElement('input');
            input.value = value;
            cell.appendChild(input);
        }

        const actionCell = cells[cellCount];
        const saveButton = actionCell.firstChild;
        saveButton.textContent = 'Update';
        saveButton.onclick = function () {
            updateRow(this);
        };

        const cancelButton = actionCell.lastChild;
        cancelButton.textContent = 'Delete';
        cancelButton.onclick = function () {
            deleteRow(this);
        };
    }

    // Function to save the added row
    function saveRow(button) {
        const row = button.parentNode.parentNode;
        const inputs = row.querySelectorAll('input');
        const cellCount = inputs.length;

        for (let i = 0; i < cellCount; i++) {
            const input = inputs[i];
            const value = input.value;
            const cell = row.cells[i];

            cell.innerHTML = value;
        }

        const actionCell = row.cells[cellCount];
        const editButton = document.createElement('button');
        editButton.textContent = 'Edit';
        editButton.onclick = function () {
            editRow(this);
        };
        actionCell.appendChild(editButton);

        const deleteButton = document.createElement('button');
        deleteButton.textContent = 'Delete';
        deleteButton.onclick = function () {
            deleteRow(this);
        };
        actionCell.appendChild(deleteButton);
    }

    // Function to update the edited row
    function updateRow(button) {
        const row = button.parentNode.parentNode;
        const inputs = row.querySelectorAll('input');
        const cellCount = inputs.length;

        for (let i = 0; i < cellCount; i++) {
            const input = inputs[i];
            const value = input.value;
            const cell = row.cells[i];

            cell.innerHTML = value;
        }

        const actionCell = row.cells[cellCount];
        const editButton = actionCell.firstChild;
        editButton.textContent = 'Edit';
        editButton.onclick = function () {
            editRow(this);
        };

        const deleteButton = actionCell.lastChild;
        deleteButton.textContent = 'Delete';
        deleteButton.onclick = function () {
            deleteRow(this);
        };
    }

    // Function to cancel editing and remove the added row
    function cancelEditRow(button) {
        const row = button.parentNode.parentNode;
        row.remove();
    }

    // Function to delete a row
    function deleteRow(button) {
        const row = button.parentNode.parentNode;
        row.remove();
    }

    // Function to save the table data to a CSV file
    function saveTable(tableId) {
        const table = document.getElementById(tableId);
        const rows = table.rows;
        const rowCount = rows.length;
        const colCount = rows[0].cells.length;
        const csvContent = [];

        // Get the header row
        const headerRow = [];
        for (let i = 0; i < colCount; i++) {
            const headerCell = rows[0].cells[i].textContent;
            headerRow.push(headerCell);
        }
        csvContent.push(headerRow.join(','));

        // Get the data rows
        for (let i = 1; i < rowCount; i++) {
            const dataRow = [];
            for (let j = 0; j < colCount; j++) {
                const dataCell = rows[i].cells[j].textContent;
                dataRow.push(dataCell);
            }
            csvContent.push(dataRow.join(','));
        }

        // Create a Blob object with the CSV content
        const csvData = csvContent.join('\n');
        const blob = new Blob([csvData], { type: 'text/csv' });

        // Create a download link and trigger the download
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'table_data.csv';
        link.click();
    }

    // Retrieve the sub-table data from Flask and render the table
    var subTableData1 = JSON.parse('{{ sub_table1 | tojson }}');
    var subTable1 = document.getElementById('sub-table1');

    // Iterate over the sub-table data and create table rows
    subTableData1.forEach(function (rowData) {
        var row = document.createElement('tr');

        // Iterate over the row data and create table cells
        Object.values(rowData).forEach(function (cellData) {
            var cell = document.createElement('td');
            cell.textContent = cellData;

            row.appendChild(cell);
        });

        var actionCell = document.createElement('td');
        var editButton = document.createElement('button');
        editButton.textContent = 'Edit';
        editButton.onclick = function () {
            editRow(this);
        };
        actionCell.appendChild(editButton);

        row.appendChild(actionCell);
        subTable1.appendChild(row);
    });

    console.log(subTableData1);

    var subTableData2 = JSONparse('{{ sub_table2 | tojson }}');
    var subTable2 = document.getElementById('sub-table2');

    // Iterate over the sub-table data and create table rows
    subTableData2.forEach(function (rowData) {
        var row = document.createElement('tr');

        // Iterate over the row data and create table cells
        Object.values(rowData).forEach(function (cellData) {
            var cell = document.createElement('td');
            cell.textContent = cellData;

            row.appendChild(cell);
        });

        var actionCell = document.createElement('td');
        var editButton = document.createElement('button');
        editButton.textContent = 'Edit';
        editButton.onclick = function () {
            editRow(this);
        };
        actionCell.appendChild(editButton);

        row.appendChild(actionCell);
        subTable2.appendChild(row);
    });

    var subTableData3 = JSON.parse('{{ sub_table3 | tojson }}');
    var subTable3 = document.getElementById('sub-table3');

    // Iterate over the sub-table data and create table rows
    subTableData3.forEach(function (rowData) {
        var row = document.createElement('tr');

        // Iterate over the row data and create table cells
        Object.values(rowData).forEach(function (cellData) {
            var cell = document.createElement('td');
            cell.textContent = cellData;
            row.appendChild(cell);
        });

        var actionCell = document.createElement('td');
        var editButton = document.createElement('button');
        editButton.textContent = 'Edit';
        editButton.onclick = function () {
            editRow(this);
        };
        actionCell.appendChild(editButton);

        row.appendChild(actionCell);
        subTable3.appendChild(row);
    });
</script>
</body>
</html>
