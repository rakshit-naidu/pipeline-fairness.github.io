<!DOCTYPE html>
<html>
  <head>
    <title>PROBLEM FORMULATION : PREDICTIVE ATTRIBUTES</title>
    <style>
      /* Add custom styles for the table if needed */
      .post-container {
            margin: 20px 20px 0 0;  
            border: 5px solid #333;
            overflow: auto
        }
        .post-thumb {
            float: left
        }
        .post-thumb img {
            display: block;
            width: 200px;
            height: auto;
        }
        .post-content {
            margin-left: 210px
        }
        .post-title {
            font-weight: bold;
            font-size: 200%;
            padding: 9px;
            background: #ccc
        }

        .tabs {
        margin-top: 20px;
        }

        .tabs ul {
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: space-between;
        }

        .tabs li {
        flex: 1;
        text-align: center;
        }

        .tabs li a {
        display: block;
        padding: 10px;
        background-color: #f2f2f2;
        color: #333;
        text-decoration: none;
        border: 1px solid #ccc;
        border-bottom: none;
        }

        .tabs li.active a {
        background-color: #fff;
        border-color: #ccc;
        }

        .tab-content {
        display: none;
        }

        .tab-content.active {
        display: block;
        }

        .tab-content table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1px;
        }

        .tab-content table th,
        .tab-content table td {
        padding: 5px;
        text-align: center;
        border: 1px solid #ccc;
        }
    </style>
  </head>
  <body>
    <div class="post-container">
        <h3 class="post-title">PROBLEM FORMULATION : PREDICTIVE ATTRIBUTES</h3>
        <div class="post-thumb"><img src="/static/problem_formulation.png" alt="PROBLEM FORMULATION"/></div>
        <div class="post-content">
            <p>Problem formulation is the translation of a real-world problem to a prediction
              task: for example, turning a bank's need to select certain individuals to give loans to, or the need to reach children in
              danger of not graduating high school with certain resources, into a machine learning system with numerical inputs and
              outputs. We focus on three main decisions here: selecting a prediction target, what inputs should be used to predict
              that target, and the prediction universe. The selection of a prediction target translates the ultimate goal of a business
              or policy problem into a numerical data representation of that goal: for example, predicting “creditworthiness” by
              predicting the probability of missing a payment on a loan. Selection of inputs includes discussion over what features in
              the available data are acceptable to use to predict the target: e.g. whether it is morally acceptable to use access to a
              telephone as a predictor of a failure to appear in pretrial risk assessment instruments. The selection of the
              prediction universe determines who predictions are made over to solve this problem: for example, when predicting
              likelihood of not graduating high school, is this predicted over 7th graders, 9th graders, or 11th graders?</p>
        </div>
      </div>
      <div class="tabs">
        <ul>
            <!-- <li><a href="#casestudy">Case Study</a></li> -->
            <li class="active"><a href="#problemidentification">Problem Identification</a></li>
            <li><a href="#measurement">Measurement</a></li>
            <li><a href="#mitigation">Mitigation</a></li>
        </ul>
        <div class="tab-content active" id="problemidentification">
            <table id="sub-table1">
                <thead>
                <tr>
                    <th>Paper Title</th>
                    <th>Authors</th>
                    <th>Description</th>
                    <th>Tags/Comments</th>
                    <th>Conference Venue</th>
                    <th>Year</th>
                    <th>Paper link</th>
                    <th>Additional resources</th>
                    <th>Action</th>
                </tr>
                </thead>
                <tbody>
                <!-- Table rows will be dynamically generated by JavaScript -->
                {% for row in sub_table1 %}
                <tr>
                    {% for cell in row %}
                    {% if cell == "Paper link" %}
                    {% if row[cell] == "N/A"%}
                    <td></td>
                    {% else %}
                    <td><a href="{{ row[cell] }}">Link</a></td>
                    {% endif %}
                    {% else %}
                    <td>{{ row[cell] }}</td>
                    {% endif %}
                    {% endfor %}
                    <td><button onclick="editRow(this)">Edit</button></td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
            <button onclick="addRow('sub-table1')">Add Row</button>
            <button onclick="saveTable('sub-table1')">Save Table</button>
        </div>
        <div class="tab-content" id="measurement">
            <table id="sub-table2">
                <thead>
                <tr>
                    <th>Paper Title</th>
                    <th>Authors</th>
                    <th>Description</th>
                    <th>Tags/Comments</th>
                    <th>Conference Venue</th>
                    <th>Year</th>
                    <th>Paper link</th>
                    <th>Additional resources</th>
                    <th>Action</th>
                </tr>
                </thead>
                <tbody>
                <!-- Table rows will be dynamically generated by JavaScript -->
                {% for row in sub_table2 %}
                <tr>
                    {% for cell in row %}
                    {% if cell == "Paper link" %}
                    {% if row[cell] == "N/A"%}
                    <td></td>
                    {% else %}
                    <td><a href="{{ row[cell] }}">Link</a></td>
                    {% endif %}
                    {% else %}
                    <td>{{ row[cell] }}</td>
                    {% endif %}
                    {% endfor %}
                    <td><button onclick="editRow(this)">Edit</button></td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
            <button onclick="addRow('sub-table2')">Add Row</button>
            <button onclick="saveTable('sub-table2')">Save Table</button>
        </div>
        <div class="tab-content" id="mitigation">
            <table id="sub-table3">
                <thead>
                <tr>
                    <th>Paper Title</th>
                    <th>Authors</th>
                    <th>Description</th>
                    <th>Tags/Comments</th>
                    <th>Conference Venue</th>
                    <th>Year</th>
                    <th>Paper link</th>
                    <th>Additional resources</th>
                    <th>Action</th>
                </tr>
                </thead>
                <tbody>
                <!-- Table rows will be dynamically generated by JavaScript -->
                {% for row in sub_table3 %}
                <tr>
                    {% for cell in row %}
                    {% if cell == "Paper link" %}
                    {% if row[cell] == "N/A"%}
                    <td></td>
                    {% else %}
                    <td><a href="{{ row[cell] }}">Link</a></td>
                    {% endif %}
                    {% else %}
                    <td>{{ row[cell] }}</td>
                    {% endif %}
                    {% endfor%}
                    <td><button onclick="editRow(this)">Edit</button></td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
            <button onclick="addRow('sub-table3')">Add Row</button>
            <button onclick="saveTable('sub-table3')">Save Table</button>
        </div>
    </div>
    <script>
        const tabLinks = document.querySelectorAll('.tabs li a');
        const tabContents = document.querySelectorAll('.tab-content');
    
        tabLinks.forEach((link) => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
    
                const targetId = e.target.getAttribute('href').substr(1);
                console.log(targetId)
    
                tabLinks.forEach((link) => {
                    link.parentNode.classList.remove('active');
                });
    
                tabContents.forEach((content) => {
                    content.classList.remove('active');
                });
    
                e.target.parentNode.classList.add('active');
                document.getElementById(targetId).classList.add('active');
            });
        });
    
        // Function to add a new row
        function addRow(tableId) {
            const table = document.getElementById(tableId);
            const row = table.insertRow(-1);
            const cellCount = table.rows[0].cells.length;
    
            for (let i = 0; i < cellCount; i++) {
                const cell = row.insertCell(i);
                const input = document.createElement('input');
                cell.appendChild(input);
            }
    
            const actionCell = row.insertCell(cellCount);
            const saveButton = document.createElement('button');
            saveButton.textContent = 'Save';
            saveButton.onclick = function () {
                saveRow(this);
            };
            actionCell.appendChild(saveButton);
    
            // const cancelButton = document.createElement('button');
            // cancelButton.textContent = 'Cancel';
            // cancelButton.onclick = function () {
            //     cancelEditRow(this);
            // };
            // actionCell.appendChild(cancelButton);
        }
    
        // Function to edit a row
        function editRow(button) {
            const row = button.parentNode.parentNode;
            const cells = row.cells;
            const cellCount = cells.length - 1; // Exclude action cell
            console.log(cellCount)
            for (let i = 0; i < cellCount; i++) {
              const cell = cells[i];
              let value = cell.textContent.trim();
              if (i == cells.length - 3) { 
                  const link = document.createElement('a');
                  link.href = value;
                  link.textContent = 'Link';
                  cell.innerHTML = '';
                  cell.appendChild(link);
              } 
              else {
                  cell.innerHTML = '';
                  const input = document.createElement('input');
                  input.value = value;
                  cell.appendChild(input);
              }
            }
    
            const actionCell = cells[cellCount];
            const editButton = actionCell.firstChild;
            editButton.style.display = 'none';
    
            let deleteButton = actionCell.querySelector('button.delete');
            if (!deleteButton) {
                deleteButton = document.createElement('button');
                deleteButton.textContent = 'Delete';
                deleteButton.className = 'delete';
                deleteButton.onclick = function () {
                    deleteRow(this);
                };
                actionCell.appendChild(deleteButton);
            }
    
            deleteButton.style.display = 'inline-block';
        }
    
        // Function to update the edited row
        function updateRow(button) {
            const row = button.parentNode.parentNode;
            const inputs = row.querySelectorAll('input');
            const cellCount = inputs.length;
    
            for (let i = 0; i < cellCount; i++) {
                const input = inputs[i];
                const value = input.value;
                const cell = row.cells[i];
    
                cell.innerHTML = value;
            }
        }
    
        // Function to cancel editing and remove the added row
        function cancelEditRow(button) {
            const row = button.parentNode.parentNode;
            row.remove();
        }
    
        // Function to delete a row
        function deleteRow(button) {
            const row = button.parentNode.parentNode;
            row.remove();
        }
    
        
        // Function to save the table data to a CSV file
        function saveTable(tableId) {
            const table = document.getElementById(tableId);
            const rows = table.rows;
            const rowCount = rows.length;
            const colCount = rows[0].cells.length;
            const csvContent = [];
    
            // Get the header row
            const headerRow = [];
            for (let i = 0; i < colCount; i++) {
                const headerCell = rows[0].cells[i].textContent;
                headerRow.push(headerCell);
            }
            csvContent.push(headerRow.join(','));
    
            // Get the data rows
            for (let i = 1; i < rowCount; i++) {
                const dataRow = [];
                for (let j = 0; j < colCount; j++) {
                    const dataCell = rows[i].cells[j].textContent;
                    dataRow.push(dataCell);
                }
                csvContent.push(dataRow.join(','));
            }
    
            // Create a Blob object with the CSV content
            const csvData = csvContent.join('\n');
            const blob = new Blob([csvData], { type: 'text/csv' });
    
            exitEditingMode(tableId);
        }
    
        // Function to exit the editing mode and remove input fields
        function exitEditingMode(tableId) {
            const table = document.getElementById(tableId);
            const rows = table.rows;
            const rowCount = rows.length;
            const colCount = rows[0].cells.length;
    
            // Iterate over the rows and remove input fields
            for (let i = 1; i < rowCount; i++) {
                const row = rows[i];
                const cells = row.cells;
    
                // Iterate over the cells and remove input fields
                for (let j = 0; j < colCount; j++) {
                    const cell = cells[j];
                    const input = cell.querySelector('input');
                    if (input) {
                        cell.textContent = input.value;
                    }
                }
    
                // Restore edit button and remove cancel button
                const actionCell = row.cells[colCount];
                const editButton = document.createElement('button');
                editButton.textContent = 'Edit';
                editButton.onclick = function () {
                    editRow(this);
                };
                actionCell.innerHTML = '';
                actionCell.appendChild(editButton);
            }
        }
    
        // Retrieve the sub-table data from Flask and render the table
        var subTableData1 = JSON.parse('{{ sub_table1 | tojson }}');
        var subTable1 = document.getElementById('sub-table1');
    
        // Iterate over the sub-table data and create table rows
        subTableData1.forEach(function (rowData) {
            var row = document.createElement('tr');
    
            // Iterate over the row data and create table cells
            Object.values(rowData).forEach(function (cellData) {
                var cell = document.createElement('td');
                cell.textContent = cellData;
    
                row.appendChild(cell);
            });
    
            var actionCell = document.createElement('td');
            var editButton = document.createElement('button');
            editButton.textContent = 'Edit';
            editButton.onclick = function () {
                editRow(this);
            };
            actionCell.appendChild(editButton);
    
            row.appendChild(actionCell);
            subTable1.appendChild(row);
        });
    
        var subTableData2 = JSON.parse('{{ sub_table2 | tojson }}');
        var subTable2 = document.getElementById('sub-table2');
    
        // Iterate over the sub-table data and create table rows
        subTableData2.forEach(function (rowData) {
            var row = document.createElement('tr');
    
            // Iterate over the row data and create table cells
            Object.values(rowData).forEach(function (cellData) {
                var cell = document.createElement('td');
                cell.textContent = cellData;
    
                row.appendChild(cell);
            });
    
            var actionCell = document.createElement('td');
            var editButton = document.createElement('button');
            editButton.textContent = 'Edit';
            editButton.onclick = function () {
                editRow(this);
            };
            actionCell.appendChild(editButton);
    
            row.appendChild(actionCell);
            subTable2.appendChild(row);
        });
    
        var subTableData3 = JSON.parse('{{ sub_table3 | tojson }}');
        var subTable3 = document.getElementById('sub-table3');
    
        // Iterate over the sub-table data and create table rows
        subTableData3.forEach(function (rowData) {
            var row = document.createElement('tr');
    
            // Iterate over the row data and create table cells
            Object.values(rowData).forEach(function (cellData) {
                var cell = document.createElement('td');
                cell.textContent = cellData;
                row.appendChild(cell);
            });
    
            var actionCell = document.createElement('td');
            var editButton = document.createElement('button');
            editButton.textContent = 'Edit';
            editButton.onclick = function () {
                editRow(this);
            };
            actionCell.appendChild(editButton);
    
            row.appendChild(actionCell);
            subTable3.appendChild(row);
        });
    </script>
    </body>
    </html>